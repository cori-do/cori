# =============================================================================
# Cori Configuration
# =============================================================================
# Project: demo
# Generated by: cori init
# Conforms to: CoriDefinition.schema.json
#
# This is the main configuration file for Cori - The Secure Kernel for AI.
# It defines database connection, Biscuit tokens, MCP server, and audit logging.
#
# Convention over configuration:
#   - Schema files are loaded from schema/ directory
#   - Role files are loaded from roles/ directory  
#   - Group files are loaded from groups/ directory
#   - Keys are loaded from keys/ directory
# =============================================================================

project: demo
version: "1.0"

# =============================================================================
# UPSTREAM DATABASE
# =============================================================================
# The PostgreSQL database that Cori protects.
# Three configuration methods supported (choose one):

upstream:
  # Method 1: Environment variable (RECOMMENDED for production)
  # database_url_env: DATABASE_URL
  
  # Method 2: Direct URL (for development only - don't commit secrets!)
  # database_url: postgres://user:pass@localhost:5432/mydb
  
  # Method 3: Individual fields
  host: localhost
  port: 5432
  database: cori_demo
  username: postgres
  password: postgres
  # password_env: POSTGRES_PASSWORD  # Reference env var for password
  
  # Optional: SSL and connection pool settings
  # ssl_mode: prefer  # disable, allow, prefer, require, verify-ca, verify-full
  # pool:
  #   min_connections: 1
  #   max_connections: 10
  #   acquire_timeout_seconds: 30
  #   idle_timeout_seconds: 600

# =============================================================================
# BISCUIT TOKEN CONFIGURATION
# =============================================================================
# Authentication via cryptographic Biscuit tokens.
# Keys are auto-generated in keys/ directory during init.

biscuit:
  public_key_file: keys/public.key
  private_key_file: keys/private.key
  # Or via environment variables (for production):
  # public_key_env: BISCUIT_PUBLIC_KEY
  # private_key_env: BISCUIT_PRIVATE_KEY

# =============================================================================
# MCP SERVER (Model Context Protocol)
# =============================================================================
# Expose database actions as typed tools for AI agents.
# Transport can be overridden with CLI flags: --http or --stdio

mcp:
  enabled: true
  transport: http  # Default for multi-tenant (token per request)
  
  # HTTP port (only used when transport is http)
  # http_port: 3000
  
  # For stdio transport (Claude Desktop and local agents):
  # transport: stdio
  # Note: stdio mode requires a token via --token flag or CORI_TOKEN env var

# =============================================================================
# ADMIN DASHBOARD
# =============================================================================

dashboard:
  enabled: true
  host: 127.0.0.1
  port: 8080
  auth:
    type: basic
    users:
      - username: admin
        password_env: DASHBOARD_ADMIN_PASSWORD

# =============================================================================
# AUDIT LOGGING
# =============================================================================

audit:
  enabled: true
  directory: logs/
  stdout: false
  retention_days: 90

# =============================================================================
# OBSERVABILITY (optional)
# =============================================================================

# observability:
#   metrics:
#     enabled: true
#     port: 9090
#     path: /metrics
#   health:
#     enabled: true
#     port: 8081
#     path: /health
